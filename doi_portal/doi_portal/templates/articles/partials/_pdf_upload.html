<style>
    .border-dashed { border-style: dashed !important; }
</style>
<div id="pdf-section">
    {% if error %}
    <div class="alert alert-danger mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
    </div>
    {% endif %}

    <!-- Status: Scanning - show spinner + polling -->
    {% if article.pdf_status == "scanning" %}
    <div class="d-flex align-items-center text-info mb-3"
         hx-get="{% url 'articles:pdf-status' article_pk=article.pk %}"
         hx-trigger="every 3s"
         hx-target="#pdf-section"
         hx-swap="outerHTML">
        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
        <span>Skeniranje u toku...</span>
    </div>
    {% endif %}

    <!-- Status: Clean - show file info -->
    {% if article.pdf_status == "clean" %}
    <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
            <i class="bi bi-file-earmark-pdf text-success me-2" style="font-size: 1.5rem;"></i>
            <span class="fw-bold">{{ article.pdf_original_filename }}</span>
            <span class="badge bg-success ms-2">
                <i class="bi bi-shield-check me-1"></i>Čist
            </span>
        </div>
        <button type="button" class="btn btn-sm btn-outline-danger"
                hx-post="{% url 'articles:pdf-delete' article_pk=article.pk %}"
                hx-target="#pdf-section"
                hx-swap="outerHTML"
                hx-confirm="Da li ste sigurni da želite ukloniti PDF?">
            <i class="bi bi-trash me-1"></i>Ukloni
        </button>
    </div>
    {% endif %}

    <!-- Status: Infected - show warning -->
    {% if article.pdf_status == "infected" %}
    <div class="alert alert-danger mb-3">
        <i class="bi bi-shield-exclamation me-2"></i>
        Fajl odbijen: detektovana bezbednosna pretnja. Izaberite drugi fajl.
    </div>
    {% endif %}

    <!-- Status: Scan Failed - show retry option -->
    {% if article.pdf_status == "scan_failed" %}
    <div class="alert alert-warning mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i>
        Skeniranje neuspešno. Pokušajte ponovo kasnije.
    </div>
    {% endif %}

    <!-- Upload form (show when: none, infected, scan_failed, or clean for replacement) -->
    {% if article.pdf_status != "scanning" %}
    <form hx-post="{% url 'articles:pdf-upload' article_pk=article.pk %}"
          hx-target="#pdf-section"
          hx-swap="outerHTML"
          hx-encoding="multipart/form-data"
          x-data="pdfUpload()">
        {% csrf_token %}
        <div class="border rounded p-3 text-center"
             @dragover.prevent="isDragging = true"
             @dragleave.prevent="isDragging = false"
             @drop.prevent="handleDrop($event)"
             :class="isDragging ? 'border-primary bg-light' : 'border-dashed'">
            <i class="bi bi-cloud-upload" style="font-size: 2rem;"></i>
            <p class="mb-2">Prevucite PDF fajl ovde ili</p>
            <label class="btn btn-outline-primary btn-sm">
                <i class="bi bi-folder2-open me-1"></i>Izaberite fajl
                <input type="file" name="pdf_file" accept=".pdf,application/pdf"
                       class="d-none" @change="fileSelected($event)">
            </label>
            <p class="text-muted small mt-2 mb-0">Maksimalna veličina: 100 MB, samo PDF format</p>
        </div>
        <!-- Progress indicator (hidden until upload starts) -->
        <div x-show="uploading" class="mt-2">
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated"
                     style="width: 100%">Otpremanje...</div>
            </div>
        </div>
    </form>
    {% endif %}
</div>
