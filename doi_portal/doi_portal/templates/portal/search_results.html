{% extends "portal/base.html" %}
{% load static %}
{% load portal_tags %}

{% block title %}Pretraga članaka{% if query %} - "{{ query }}"{% endif %}{% endblock title %}

{% block portal_content %}
<div class="row">
  <!-- Filter Sidebar (Desktop) -->
  <aside class="col-lg-3 mb-4 d-none d-lg-block">
    {% include "portal/partials/_article_filter_sidebar.html" %}
  </aside>

  <!-- Mobile Filter Button -->
  <div class="d-lg-none mb-3">
    <button class="btn btn-outline-primary w-100"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#filterOffcanvas"
            aria-controls="filterOffcanvas">
      <i class="bi bi-funnel" aria-hidden="true"></i> Filteri
      {% if has_active_filters %}
        <span class="badge bg-primary ms-1">Aktivni</span>
      {% endif %}
    </button>
  </div>

  <!-- Mobile Offcanvas -->
  <div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="filterOffcanvas"
       aria-labelledby="filterOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="filterOffcanvasLabel">Filteri</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Zatvori"></button>
    </div>
    <div class="offcanvas-body">
      {% include "portal/partials/_article_filter_sidebar.html" %}
      <button type="button" class="btn btn-primary w-100 mt-3" data-bs-dismiss="offcanvas">
        Primeni filtere
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <section class="col-lg-9">
    <h1 class="h3 mb-3">Pretraga članaka</h1>

    <!-- Search Form -->
    <form action="{% url 'article-search' %}" method="get" role="search" class="mb-4">
      <div class="input-group">
        <input type="search" name="q" value="{{ query }}" class="form-control"
               placeholder="Pretražite članke po naslovu, autoru, ključnim rečima..."
               aria-label="Pretraga članaka"
               minlength="3">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-search"></i> Pretraži
        </button>
      </div>
      {% if query and query|length < min_query_length %}
      <div class="form-text text-warning mt-1">
        Unesite najmanje {{ min_query_length }} karaktera za pretragu.
      </div>
      {% endif %}
    </form>

    <!-- Results -->
    <div id="search-results" class="search-results" aria-live="polite">
      {% include "portal/partials/_search_results.html" %}
    </div>
  </section>
</div>
{% endblock portal_content %}
