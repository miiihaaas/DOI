{% extends "portal/base.html" %}
{% load static i18n %}

{% block title %}Publikacije - DOI Portal{% endblock title %}

{% block meta_description %}Pregledajte sve naučne publikacije na DOI Portalu. Filtrirajte po tipu, oblasti, jeziku i pristupu.{% endblock meta_description %}

{% block portal_content %}
<div class="row">
    <!-- Filter Sidebar -->
    <aside class="col-lg-3 mb-4">
        <div class="card">
            <div class="card-body">
                <h2 class="h5 card-title mb-3">Filteri</h2>

                <!-- Search Box -->
                <div class="mb-3">
                    <label for="search-input" class="form-label fw-semibold">Pretraživanje</label>
                    <input type="text"
                           id="search-input"
                           name="search"
                           class="form-control"
                           placeholder="Pretražite publikacije..."
                           value="{{ search_query }}"
                           hx-get="{% url 'portal-publications:publication-list' %}"
                           hx-trigger="keyup changed delay:300ms"
                           hx-target="#publication-results"
                           hx-include="[name='type'],[name='subject'],[name='access'],[name='language']"
                           hx-replace-url="true"
                           aria-label="Pretražite publikacije po naslovu">
                </div>

                <hr>

                <!-- Type Filter (multiselect checkboxes - AC #2) -->
                <fieldset class="mb-3">
                    <legend class="form-label fw-semibold h6">Tip publikacije</legend>
                    {% for value, label in publication_types %}
                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="type"
                               id="type-{{ value }}"
                               value="{{ value }}"
                               {% if value in current_types %}checked{% endif %}
                               hx-get="{% url 'portal-publications:publication-list' %}"
                               hx-trigger="change"
                               hx-target="#publication-results"
                               hx-include="[name='search'],[name='type'],[name='subject'],[name='access'],[name='language']"
                               hx-push-url="true">
                        <label class="form-check-label" for="type-{{ value }}">
                            {{ label }}
                        </label>
                    </div>
                    {% endfor %}
                </fieldset>

                <hr>

                <!-- Subject Area Filter (multiselect checkboxes - AC #2) -->
                {% if subject_areas %}
                <fieldset class="mb-3">
                    <legend class="form-label fw-semibold h6">Naučna oblast</legend>
                    {% for area in subject_areas %}
                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="subject"
                               id="subject-{{ forloop.counter }}"
                               value="{{ area }}"
                               {% if area in current_subjects %}checked{% endif %}
                               hx-get="{% url 'portal-publications:publication-list' %}"
                               hx-trigger="change"
                               hx-target="#publication-results"
                               hx-include="[name='search'],[name='type'],[name='subject'],[name='access'],[name='language']"
                               hx-push-url="true">
                        <label class="form-check-label" for="subject-{{ forloop.counter }}">
                            {{ area }}
                        </label>
                    </div>
                    {% endfor %}
                </fieldset>

                <hr>
                {% endif %}

                <!-- Access Type Filter (multiselect checkboxes - AC #2) -->
                <fieldset class="mb-3">
                    <legend class="form-label fw-semibold h6">Tip pristupa</legend>
                    {% for value, label in access_types %}
                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="access"
                               id="access-{{ value }}"
                               value="{{ value }}"
                               {% if value in current_access %}checked{% endif %}
                               hx-get="{% url 'portal-publications:publication-list' %}"
                               hx-trigger="change"
                               hx-target="#publication-results"
                               hx-include="[name='search'],[name='type'],[name='subject'],[name='access'],[name='language']"
                               hx-push-url="true">
                        <label class="form-check-label" for="access-{{ value }}">
                            {{ label }}
                        </label>
                    </div>
                    {% endfor %}
                </fieldset>

                <hr>

                <!-- Language Filter (multiselect checkboxes - AC #2) -->
                {% if languages %}
                <fieldset class="mb-3">
                    <legend class="form-label fw-semibold h6">Jezik</legend>
                    {% for lang in languages %}
                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="language"
                               id="language-{{ lang }}"
                               value="{{ lang }}"
                               {% if lang in current_languages %}checked{% endif %}
                               hx-get="{% url 'portal-publications:publication-list' %}"
                               hx-trigger="change"
                               hx-target="#publication-results"
                               hx-include="[name='search'],[name='type'],[name='subject'],[name='access'],[name='language']"
                               hx-push-url="true">
                        <label class="form-check-label" for="language-{{ lang }}">
                            {{ lang }}
                        </label>
                    </div>
                    {% endfor %}
                </fieldset>
                {% endif %}

                <!-- Reset All Filters -->
                {% if has_active_filters %}
                <hr>
                <a href="{% url 'portal-publications:publication-list' %}" class="btn btn-outline-danger btn-sm w-100">
                    <i class="bi bi-x-circle me-1" aria-hidden="true"></i>Obrišite sve filtere
                </a>
                {% endif %}
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <section class="col-lg-9">
        <h1 class="h3 mb-4">Publikacije</h1>

        <div id="publication-results" aria-live="polite">
            {% include "portal/publications/partials/_publication_grid.html" %}
        </div>
    </section>
</div>
{% endblock portal_content %}
