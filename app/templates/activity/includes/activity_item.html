<!-- Individual Activity Log Item Template -->
<!-- Used for displaying a single activity log entry -->

{% macro render_activity_item(activity) %}
<div class="activity-item border-start border-3 ps-3 py-2 mb-3" data-action="{{ activity.action }}">
    <div class="d-flex align-items-start">
        <!-- Activity Icon -->
        <div class="activity-icon me-3 mt-1">
            <div class="rounded-circle d-flex align-items-center justify-content-center {{ get_activity_bg_class(activity.action) }}" 
                 style="width: 32px; height: 32px;">
                <i class="{{ get_activity_icon_class(activity.action) }} text-white" style="font-size: 14px;"></i>
            </div>
        </div>
        
        <!-- Activity Details -->
        <div class="activity-details flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
                <div class="activity-content">
                    <!-- User Information -->
                    <div class="activity-user text-muted small mb-1">
                        <i class="fas fa-user me-1"></i>
                        <strong>{{ activity.user_name if activity.user_name else 'Unknown User' }}</strong>
                        {% if activity.ip_address and activity.ip_address != '0.0.0.0' %}
                            <span class="text-muted">from {{ activity.ip_address }}</span>
                        {% endif %}
                    </div>
                    
                    <!-- Activity Description -->
                    <div class="activity-description">
                        <span class="text-dark">{{ activity.description }}</span>
                    </div>
                    
                    <!-- Entity Links (if applicable) -->
                    {% if activity.member_id or activity.publication_id %}
                    <div class="activity-links mt-2">
                        {% if activity.member_id %}
                            <a href="{{ url_for('members.detail', member_id=activity.member_id) }}" 
                               class="btn btn-outline-primary btn-sm me-2">
                                <i class="fas fa-user-tie me-1"></i>View Member
                            </a>
                        {% endif %}
                        
                        {% if activity.publication_id %}
                            <a href="{{ url_for('publications.detail', publication_id=activity.publication_id) }}" 
                               class="btn btn-outline-info btn-sm">
                                <i class="fas fa-book me-1"></i>View Publication
                            </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <!-- Timestamp -->
                <div class="activity-timestamp text-muted small text-end">
                    {% if activity.created_at %}
                        <div title="{{ activity.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}">
                            <i class="fas fa-clock me-1"></i>
                            {{ activity.created_at.strftime('%m/%d %H:%M') }}
                        </div>
                    {% else %}
                        <span class="text-muted">No timestamp</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Helper functions to get icon and color classes for different activity types -->
{% macro get_activity_icon_class(action) -%}
{% if action.startswith('create') -%}fas fa-plus
{%- elif action.startswith('update') -%}fas fa-edit
{%- elif action.startswith('delete') -%}fas fa-trash
{%- elif action.startswith('activate') -%}fas fa-check
{%- elif action.startswith('deactivate') -%}fas fa-times
{%- elif action.startswith('user_login') -%}fas fa-sign-in-alt
{%- elif action.startswith('user_logout') -%}fas fa-sign-out-alt
{%- elif action.startswith('password') -%}fas fa-key
{%- else -%}fas fa-question
{%- endif -%}
{%- endmacro %}

{% macro get_activity_bg_class(action) -%}
{% if action.startswith('create') -%}bg-success
{%- elif action.startswith('update') -%}bg-primary
{%- elif action.startswith('delete') -%}bg-danger
{%- elif action.startswith('activate') -%}bg-success
{%- elif action.startswith('deactivate') -%}bg-warning
{%- elif action.startswith('user_login') -%}bg-info
{%- elif action.startswith('user_logout') -%}bg-secondary
{%- elif action.startswith('password') -%}bg-warning
{%- else -%}bg-secondary
{%- endif -%}
{%- endmacro %}

<!-- Custom CSS for activity timeline styling -->
<style>
.activity-item {
    transition: all 0.3s ease;
    border-left-color: var(--bs-border-color) !important;
}

.activity-item:hover {
    background-color: rgba(0, 123, 255, 0.05);
    border-left-color: var(--bs-primary) !important;
    border-left-width: 4px !important;
}

.activity-item[data-action^="create"] {
    border-left-color: var(--bs-success) !important;
}

.activity-item[data-action^="update"] {
    border-left-color: var(--bs-primary) !important;
}

.activity-item[data-action^="delete"] {
    border-left-color: var(--bs-danger) !important;
}

.activity-item[data-action^="activate"] {
    border-left-color: var(--bs-success) !important;
}

.activity-item[data-action^="deactivate"] {
    border-left-color: var(--bs-warning) !important;
}

.activity-icon .bg-success { background-color: var(--bs-success) !important; }
.activity-icon .bg-primary { background-color: var(--bs-primary) !important; }
.activity-icon .bg-danger { background-color: var(--bs-danger) !important; }
.activity-icon .bg-warning { background-color: var(--bs-warning) !important; }
.activity-icon .bg-info { background-color: var(--bs-info) !important; }
.activity-icon .bg-secondary { background-color: var(--bs-secondary) !important; }

.text-xs {
    font-size: 0.75rem !important;
}

@media (max-width: 576px) {
    .activity-item {
        border-left-width: 2px !important;
        padding-left: 1rem !important;
    }
    
    .activity-icon {
        margin-right: 0.75rem !important;
    }
    
    .activity-icon > div {
        width: 24px !important;
        height: 24px !important;
    }
    
    .activity-links .btn {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
}
</style>